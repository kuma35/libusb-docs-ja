<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libusb: パケットとオーバーフロー</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top">
<!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="libusb.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libusb &#160;<span id="projectnumber">1.0.24</span>
   </div>
   <div id="projectbrief">USBデバイスにアクセスするためのクロスプ・ラットフォームのユーザー・ライブラリ</div>
  </td>
 </tr>
 </tbody>
</table>
</div>


<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license
magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt
GPL-v2 */ $(function() { initMenu('',false,false,'search.php','Search'); });
/* @license-end */</script>
<div id="main-nav"></div>
</div>
<!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">パケットとオーバーフロー </div>  </div>
</div>
<!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="packets"></a> パケットの抽象化</h1>
<p>USB仕様には、データがパケットで送信される方法が説明されていて、そしてエンド・ポイント・デスクリプターによって定義されたパケット・サイズには制限があります。ホストは、エンド・ポイントの最大パケット・サイズよりも大きいデータ・ペイロードを送信してはなりません。</p>
<p>libusbと基盤となるOSは、パケットの概念を抽象化し、任意のサイズの転送を要求できるようにします。内部的には、要求は正しいサイズのパケットに分割されます。
パケット・サイズを気にする必要はありませんが、オーバーフローを考慮する場合は1つの例外があります。</p>
<h1><a class="anchor" id="overflow"></a> バルク転送・割り込み転送のオーバーフロー</h1>
<p>バルク・エンド・ポイントでデータを要求する場合、libusbでは、バッファーと、libusbがそのバッファーに入れることができるデータの最大バイト数を指定する必要があります。
ただし、バッファのサイズはデバイスに伝達されません。デバイスは、任意の量のデータを送信するように要求されるだけです。</p>
<p>デバイスがバッファ・サイズ以下のデータ量を送信する場合は問題ありません。 libusbは、 <a class="el"
href="structlibusb__transfer.html#a7e858f07c48a271a62209d11376ae607">libusb_transfer.actual_length</a>
フィールドを介してこの状態を報告します。</p>
<p>デバイスがバッファに収まらないより多くのデータを送信しようとすると、問題が発生する可能性があります。
libusbは、この状態についてLIBUSB_TRANSFER_OVERFLOWを報告しますが、他の動作はほとんど定義されていません。actual_lengthは正確である場合とそうでない場合があり、(オーバーフロー前に)バッファーに収まるデータのチャンクが転送されている場合とされていない場合があります。</p>
<p>オーバーフローは厄介ですが、回避することができます。あなたが上記のパケットを無視するように言われたとしても、下位レベルの詳細について考えてください。各転送はパケットに分割されます(通常は小さく、最大サイズは512バイトです)。オーバーフローは、着信データ転送の最後のパケットが、デバイスが転送したい実際のパケットよりも小さい場合にのみ発生する可能性があります。したがって、転送バッファサイズがエンドポイントのパケット・サイズの倍数である場合、オーバーフローが発生することはありません。最終的なパケットは完全にいっぱいになるか、部分的にしかいっぱいになりません。 </p>
</div></div>
<!-- contents -->
</div>

<!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small> Generated on Fri Jul 9 2021 02:35:39 for libusb by &#160;<a
href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17 </small></address>
</body>
</html>
